<html> 
<head> 
<title>nowjs test</title> 
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script> 
<script src="/nowjs/now.js"></script>

<script>
$(document).ready(function(){

  
  now.name = prompt("What's your name?", "");
  
  now.receiveMessageNoNotifications = function(name, message){
  	appendMessage(name,message);
  }
    
  now.receiveMessage = function(name, message){
    appendMessage(name,message);
    playSound("http://4umi.com/web/sound/beeplo.wav");
  }
  
  now.receiveUserList = function(userListString) {
  	$("#users").text(userListString);
  }
  
  $("#send-button").click(function(){
    distribute();
  });
  
  $("#text-input").keypress(function(event) {
  if (event.which == 13) {
     distribute();
   }
	});
  
});

function appendMessage(name,message){
	if (name == now.name) {
		$("#messages").append("<div class='message'>" + "<i>" + name + "</i>" + ": " + message + "</div>");
	} else {
		$("#messages").append("<div class='message'>" + name + ": " + message + "</div>");
	}
}

function distribute(){
	now.distributeMessage($("#text-input").val());
	$("#text-input").val("");
	if ($("#messages div").length > 10){
		$("#messages > div:first").remove();
	}
}

function playSound( url ){   
  document.getElementById("sound").innerHTML="<embed src='"+url+"' hidden=true autostart=true loop=false>";
}

</script>
</head> 
 
<body> 
<div id="messages"></div>
<div id="sound" ></div>
<div id="users" style="font-weight:bold;"></div>

<input type="text" id="text-input">
<input type="button" value="Send" id="send-button">
</body> 
</html> 
