<html> 
<head> 
<title>nowjs test</title> 
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script> 
<script src="/nowjs/now.js"></script>

<script>
$(document).ready(function(){

	var t;
  
  now.name = prompt("What's your name?", "");
  
  now.receiveMessageNoNotifications = function(name, message){
  	appendMessage(name,message);
  }
    
  now.receiveMessage = function(name, message){
    appendMessage(name,message);
    playSound("http://4umi.com/web/sound/beeplo.wav");
		if (name != now.name)
			newMessageNotification();
  }
  
  now.receiveUserList = function(userListString) {
  	$("#users").text(userListString);
  }
  
  $("#send-button").click(function(){
    distribute();
  });
  
  $("#text-input").keypress(function(event) {
  if (event.which == 13) {
     distribute();
   }
	});

	$(window).click(function() {
  	clearMessageNotification();
  });
  
	
});

function clearMessageNotification(){
	$("#notification").text("");
	$("#notification").css("background","white");
	$("#notification").css("height","0px");
	clearTimeout(t);
}

function newMessageNotification(t){
	$("#notification").text("You have a new message!");
	$("#notification").css("background","green");
	$("#notification").css("height","80px");
	t = setTimeout("blink()",1000);
}

var blazo = true;

function blink(){	
	if (blazo == true)	{
		$("#notification").css("background","red");
		blazo = false;
		t = setTimeout("blink()",1000);
	} else {
		$("#notification").css("background","green");
		blazo = true;
		t = setTimeout("blink()",1000);
	}
}


function appendMessage(name,message){
	if (name == now.name) {
		$("#messages").append("<div class='message'>" + "<i>" + name + "</i>" + ": " + message + "</div>");
	} else {
		$("#messages").append("<div class='message'>" + name + ": " + message + "</div>");
	}
}

function distribute(){
	now.distributeMessage($("#text-input").val());
	$("#text-input").val("");
	if ($("#messages div").length > 10){
		$("#messages > div:first").remove();
	}
}

function playSound( url ){   
  document.getElementById("sound").innerHTML="<embed src='"+url+"' hidden=true autostart=true loop=false>";
}

</script>
</head> 
 
<body> 
<div id="notification" style="font-size:26px;color:white;font-weight:bold;"></div>
<div id="messages"></div>
<div id="sound" ></div>
<div id="users" style="font-weight:bold;"></div>

<input type="text" id="text-input">
<input type="button" value="Send" id="send-button">
</body> 
</html> 
